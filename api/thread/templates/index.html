{% extends 'base.html' %} 
{% load static %} 
{% block meta %}
<title>Threads</title>
{% endblock meta %}

{% block content %}
<div class="flex w-full min-h-screen items-center justify-center bg-gray-50 py-8">
    <!-- Thread Creation Form -->
    <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-lg">
      <h2 class="text-2xl font-bold mb-6 text-gray-800">What's happening?</h2>
      {% include 'components/create.html' %}
    </div>
  
    <!-- Display Threads -->
    {% if threads %}
    <div class="w-full max-w-lg mt-8 space-y-4">
      {% for thread in threads %}
        {% include 'components/thread.html' with thread=thread user_id=user.id %}
      {% endfor %}
    </div>
    {% endif %}
  </div>

<script>
  const textarea = document.getElementById("content");
  const charCount = document.getElementById("char-count");
  const imageInput = document.getElementById("image");
  const imagePreview = document.getElementById("image-preview");

  textarea.addEventListener("input", function () {
    const remaining = 456 - textarea.value.length;
    charCount.textContent = `${remaining} characters remaining`;
    if (remaining < 0) {
      charCount.textContent = "You've exceeded the limit!";
    }
  });

  imageInput.addEventListener("change", function () {
    const file = imageInput.files[0]; // Get the uploaded file
    if (file) {
      const reader = new FileReader();
      reader.onload = function (e) {
        imagePreview.src = e.target.result; // Set the preview source
        imagePreview.classList.remove("hidden"); // Show the preview

        // Limit the image preview size
        imagePreview.style.maxWidth = "48px";
        imagePreview.style.maxHeight = "48px";

        // Reset the image preview size on error
        imagePreview.onerror = function () {
          imagePreview.style.maxWidth = "none";
          imagePreview.style.maxHeight = "none";
          imagePreview.src = "";
        };
      };
      reader.readAsDataURL(file); // Read the file as a data URL
    } else {
      imagePreview.classList.add("hidden"); // Hide the preview if no file
    }
  });
</script>
{% endblock content %}
